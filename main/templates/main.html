{% extends 'base.html' %}

{% load static %}

{% block content %}
{% include 'navbar.html' %}

<div class="flex justify-center px-5">
  <div class="inline-block rounded-lg border border-gray-200 my-5 mx-auto text-center max-w-lg py-3 px-5 bg-white">
    <p>{{ name }} &mdash; {{ npm }} &mdash; {{ class }}<p>
    <h5><strong>Last Login</strong>: {{ last_login }}</h5>
  </div>
</div>

<main class="px-5 sm:px-12 lg:px-24 w-full mb-32">
  <div class="w-full border-b border-gray-300 py-3 mb-5">
    <h1 class="text-3xl font-bold">Products</h1>
    <a class="text-blue-600 hover:underline" href="{% url 'main:create_product' %}">Add New Product</a>
  </div>

  <div id="product-cards-container"></div>
</main>

<script>
  async function getProducts() {
    return fetch("{% url 'main:show_json' %}").then((res) => res.json());
  }

  async function refreshProducts() {
    const products = await getProducts();
    console.log(products)

    let classNames = "";
    let htmlString = "";

    if (products.length === 0) {
      classNames = "text-center bg-white rounded-lg border border-gray-200 shadow-sm py-6 px-10 break-inside-avoid";
      htmlString = `
        <img src="{% static 'image/empty-list.png' %}" width="300" class="block mx-auto">
        <p class="text-slate-600">Belum ada produk yang terdaftar</p>
      `;
    } else {
      classNames = "columns-1 md:columns-2 lg:columns-3 xl:columns-4 space-y-3 gap-x-3";
      products.forEach((product) => {
        htmlString += `
          <div class="flex flex-col bg-white rounded-lg border border-gray-200 shadow-sm py-6 px-8 text-wrap break-inside-avoid">
            <div class="flex flex-col max-w-md min-w-md">
                <a href="/product/${product.pk}">
                <h1 class="text-xl font-bold hover:underline">${product.fields.name}</h1>
              </a>
              <h2 class="text-md mt-1">$${product.fields.price}</h2>
              <p class="text-gray-700 my-4 w-full">${product.fields.description}</p>
            </div>
            <div class="flex flex-row justify-end items-center gap-3">
              <a class="text-blue-600 hover:underline" href="/product/${product.pk}/edit">Edit</a>
              <a class="text-blue-600 hover:underline" href="/product/${product.pk}/delete">Delete</a>
            </div>
          </div>
        `;
      })
    }

    document.getElementById("product-cards-container").innerHTML = htmlString;
    document.getElementById("product-cards-container").className = classNames;
  }

  refreshProducts();
</script>

{% endblock content %}
